name: consulting-engagement
version: "1.2"
description: >
  Structured consulting workflow for decomposing a business problem into a
  MECE issue tree, executing workstreams, synthesizing recommendations,
  aligning stakeholders, and producing implementation-ready executive output.
author: "Loom Team"
tags: [consulting, strategy, problem-solving, mece, implementation, presentation]

persona: |
  You are a senior management consultant. Decompose every problem into a MECE
  issue tree before gathering data. Lead with the answer (pyramid principle),
  support with evidence, and tie recommendations to quantified impact. Every
  heading is an action title that states a conclusion.

phase_mode: strict

tool_guidance: |
  Keep outputs slide-ready: action title, supporting evidence, and "so what."
  Use CSV for exhibits and Markdown for concise notes. Explicitly label
  assumptions, confidence, and implementation dependencies.

tools:
  guidance: >
    Use web_search/web_fetch for external benchmarks, spreadsheet for impact
    models, and document_write for executive outputs.
  required: [web_search, web_fetch, spreadsheet, read_file, write_file, document_write, search_files]
  excluded: [delete_file, shell_execute, git_command]

phases:
  - id: define-issue-tree
    description: >
      Decompose the governing question into a MECE issue tree with testable
      hypotheses and explicit decision criteria.
    depends_on: []
    model_tier: 3
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      Governing question is explicit. Branches are MECE with 2-4 sub-
      hypotheses each. Tree depth is at least 3 levels. Priority rationale and
      decision criteria are explicit.
    deliverables:
      - "issue-tree.md — full issue tree with hypotheses"
      - "decision-criteria.md — explicit criteria for evaluating options"
      - "hypothesis-register.csv — hypotheses with test criteria"
      - "workstream-priorities.csv — branches ranked by impact and feasibility"

  - id: assign-workstreams
    description: >
      Convert priority branches into workstreams with scope, analysis method,
      required data, owners, and expected outputs.
    depends_on: [define-issue-tree]
    model_tier: 2
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      Each priority branch has a workstream charter with owner role,
      hypothesis, approach, required data, and timeline assumptions.
    deliverables:
      - "workstream-plan.md — workstream definitions and analysis plans"
      - "data-request-log.csv — required data inputs and source owners"

  - id: gather-evidence
    description: >
      Execute workstreams: gather evidence, test hypotheses, record verdicts,
      and capture counter-evidence.
    depends_on: [assign-workstreams]
    model_tier: 3
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      Every workstream has a hypothesis verdict supported by evidence with
      source/date and confidence. Counter-evidence is recorded.
    deliverables:
      - "workstream-findings.md — findings with hypothesis verdicts"
      - "evidence-exhibits.csv — structured evidence for each finding"

  - id: synthesize-recommendations
    description: >
      Synthesize evidence into ranked recommendations with quantified impact,
      effort, confidence, and ownership.
    depends_on: [gather-evidence]
    model_tier: 3
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      3-5 recommendations with quantified impact, effort horizon, confidence,
      owner role, and dependencies. Quick wins are separated from strategic
      bets.
    deliverables:
      - "recommendations.md — prioritized recommendations with rationale"
      - "impact-model.csv — impact, effort, and confidence per recommendation"

  - id: stakeholder-alignment
    description: >
      Map stakeholder incentives and objections, then adapt recommendation
      messaging and sequencing to improve adoption.
    depends_on: [synthesize-recommendations]
    model_tier: 2
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      Key stakeholder groups are mapped with likely objections and influence.
      Mitigation/engagement actions are linked to recommendations.
    deliverables:
      - "stakeholder-map.md — stakeholders, incentives, and influence"
      - "objection-log.csv — objections, responses, and owners"

  - id: implementation-roadmap
    description: >
      Translate recommendations into phased implementation plan with milestones,
      dependencies, risks, governance, and benefit-tracking approach.
    depends_on: [stakeholder-alignment]
    model_tier: 2
    verification_tier: 2
    is_critical_path: true
    acceptance_criteria: >
      Roadmap defines phases, milestones, decision gates, key risks, owner
      roles, and benefits tracking for first 90 days and beyond.
    deliverables:
      - "implementation-roadmap.md — phased plan with milestones and risks"
      - "initiative-charter.csv — initiatives, owners, timing, dependencies"
      - "benefits-tracker.csv — expected benefits, metrics, and review cadence"

  - id: build-presentation
    description: >
      Assemble 10-15 slide storyline for executive review. Titles must be
      conclusion statements and flow from evidence to action.
    depends_on: [implementation-roadmap]
    model_tier: 2
    verification_tier: 2
    is_critical_path: true
    is_synthesis: true
    acceptance_criteria: >
      Slide 1 is executive summary. Each title is an action-oriented conclusion
      sentence. Storyline includes evidence backbone, recommendation ranking,
      stakeholder plan, and implementation roadmap.
    deliverables:
      - "presentation-outline.md — slide-by-slide outline with action titles"
      - "executive-summary.md — one-page summary for senior leadership"

tests:
  - id: smoke
    mode: deterministic
    goal: "Run the consulting-engagement process and produce all declared deliverables."
    timeout_seconds: 900
    acceptance:
      phases:
        must_include: [define-issue-tree, assign-workstreams, gather-evidence, synthesize-recommendations, stakeholder-alignment, implementation-roadmap, build-presentation]
      deliverables:
        must_exist: [issue-tree.md, decision-criteria.md, hypothesis-register.csv, workstream-priorities.csv, workstream-plan.md, data-request-log.csv, workstream-findings.md, evidence-exhibits.csv, recommendations.md, impact-model.csv, stakeholder-map.md, objection-log.csv, implementation-roadmap.md, initiative-charter.csv, benefits-tracker.csv, presentation-outline.md, executive-summary.md]
      verification:
        forbidden_patterns: ["Expected deliverable '.*' not found", "\\[TBD\\]|\\[TODO\\]|\\[INSERT\\]|\\[PLACEHOLDER\\]"]

  - id: live-canary
    mode: live
    goal: "Execute a consulting-style strategic engagement using current evidence and recommendations."
    timeout_seconds: 1200
    requires_network: true

verification:
  rules:
    - name: mece-structure
      description: "Issue tree branches must be MECE"
      check: >
        Confirm no branch overlap and full coverage of the governing question.
        Flag duplicate/redundant sub-hypotheses.
      severity: error
      type: llm
      applies_to_phases: [define-issue-tree, assign-workstreams]

    - name: recommendation-traceability
      description: "Recommendations must trace to explicit evidence"
      check: >
        Each recommendation should cite supporting findings and exhibits.
      severity: error
      type: llm
      applies_to_phases: [synthesize-recommendations, build-presentation]

    - name: stakeholder-feasibility
      description: "Recommendations must account for stakeholder adoption risk"
      check: >
        Validate stakeholder objections, influence dynamics, and mitigation
        actions are reflected in sequencing and ownership.
      severity: error
      type: llm
      applies_to_phases: [stakeholder-alignment, implementation-roadmap, build-presentation]

    - name: action-titles
      description: "Headings must be conclusion sentences, not topic labels"
      check: >
        Each heading should contain subject and verb stating a finding.
      severity: warning
      type: llm
      applies_to_phases: [build-presentation]

    - name: no-placeholders
      description: "No placeholder text in deliverables"
      check: "\\[TBD\\]|\\[TODO\\]|\\[INSERT\\]|\\[PLACEHOLDER\\]"
      severity: error
      type: regex
      applies_to_phases: ["*"]

memory:
  extract_types:
    - type: hypothesis_verdict
      description: "Tested hypothesis and whether confirmed/refuted/modified"
    - type: key_finding
      description: "Significant finding with quantified evidence"
    - type: recommendation
      description: "Specific recommendation with impact and confidence"
    - type: stakeholder_concern
      description: "Anticipated objection from a key stakeholder role"
    - type: implementation_risk
      description: "Execution risk tied to roadmap phases"
  extraction_guidance: |
    Prioritize findings that materially change recommendation priority or
    implementation sequence. Tag stakeholder concerns by role.

workspace_analysis:
  scan_for:
    - "**/*.csv — financial data, operational metrics, or benchmarks"
    - "**/*.md — prior analyses, strategy docs, or meeting notes"
  guidance: |
    Reuse prior analyses where credible and current. Surface conflicting prior
    conclusions before synthesis.

planner_examples:
  - goal: "Advise retailer on DTC e-commerce vs doubling down on wholesale"
    subtasks:
      - { id: define-issue-tree, description: "Decompose economics, capabilities, and cannibalization", depends_on: [], model_tier: 3 }
      - { id: assign-workstreams, description: "Define streams for economics, customer, competition, capabilities", depends_on: [define-issue-tree], model_tier: 2 }
      - { id: gather-evidence, description: "Build evidence base and verdicts", depends_on: [assign-workstreams], model_tier: 3 }
      - { id: synthesize-recommendations, description: "Rank recommendations with quantified impact", depends_on: [gather-evidence], model_tier: 3 }
      - { id: stakeholder-alignment, description: "Map stakeholder objections and mitigation", depends_on: [synthesize-recommendations], model_tier: 2 }
      - { id: implementation-roadmap, description: "Sequence phased rollout", depends_on: [stakeholder-alignment], model_tier: 2 }
      - { id: build-presentation, description: "Build executive storyline and action-title slides", depends_on: [implementation-roadmap], model_tier: 2 }

replanning:
  triggers: |
    - Problem framing changes materially after evidence review
    - A workstream uncovers a showstopper making other streams moot
    - Evidence contradicts most initial hypotheses
  guidance: |
    If framing shifts, rebuild the issue tree before further analysis. If a
    showstopper emerges, accelerate to updated recommendations.
